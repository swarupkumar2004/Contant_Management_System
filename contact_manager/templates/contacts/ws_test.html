<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>📡 WebSocket Contact Updates</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f2f2f2;
    }
    h1 {
      color: #333;
    }
    ul {
      list-style-type: none;
      padding: 0;
    }
    li {
      background: #fff;
      margin: 5px 0;
      padding: 10px;
      border-left: 5px solid #4CAF50;
    }
  </style>
</head>
<body>
  <h1>📡 Contact Management System</h1>
  <ul id="log">
    <li>✅ Waiting for updates from server...</li>
  </ul>

  <script>
    const socket = new WebSocket("ws://127.0.0.1:8010/ws/contacts/");
    const log = document.getElementById("log");

    socket.onopen = () => {
      console.log("✅ WebSocket connected");
    };

    socket.onclose = () => {
      console.log("❌ WebSocket disconnected");
      const item = document.createElement("li");
      item.style.color = "red";
      item.innerText = "❌ WebSocket disconnected";
      log.prepend(item);
    };

    socket.onerror = (error) => {
      console.error("❗ WebSocket error:", error);
    };

    socket.onmessage = function(event) {
  try {
    const data = JSON.parse(event.data);
    const message = typeof data.message === "string"
      ? JSON.parse(data.message)
      : data.message;

    const item = document.createElement("li");
    item.innerText = `[${message.action.toUpperCase()}] ${message.contact.name} - ${message.contact.email} - ${message.contact.phone}`;
    log.prepend(item);
  } catch (err) {
    console.error("❌ Failed to parse WebSocket message:", err, event.data);
    const errorItem = document.createElement("li");
    errorItem.style.color = "red";
    errorItem.innerText = `❌ Error parsing message: ${event.data}`;
    log.prepend(errorItem);
  }
};

  </script>
</body>
</html>
